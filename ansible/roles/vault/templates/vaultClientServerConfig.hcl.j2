storage "raft" {
    path    = "{{ vault_data_dir }}"
    node_id = "node1"

{% for host in retry_join %}
    retry_join {
        leader_api_addr = "http://{{ host }}:8200"
    }
{% endfor %}

}

{% if ansible_host != vault_seal_leader %}
seal "transit" {
    address            = "http://{{ vault_seal_leader }}:8200"
    # token is read from VAULT_TOKEN env
    # token              = ""
    disable_renewal    = "false"

    // Key configuration
    key_name           = "unseal_key"
    mount_path         = "transit/"
}
{% endif %}

listener "tcp" {
  address = "{{ ansible_host }}:8200"
  tls_disable = "true"
  cluster_address = "{{ ansible_host }}:8201"
}

service_registration "consul" {
  address = "{{ ansible_host }}:8500"
}

ui = true
cluster_addr = "http://{{ ansible_host }}:8201"
api_addr = "http://{{ ansible_host }}:8200"